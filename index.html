<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì‚¬ë‚´ ë¯¸ë‹ˆê²Œì„ LIVE (ì˜¬ë¦¼í”½ ì—ë””ì…˜)</title>
    <style>
        /* --- ê³µí†µ ìŠ¤íƒ€ì¼ (ë‹¤í¬ëª¨ë“œ) --- */
        body {
            font-family: 'Suit', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #121212; color: #fff;
            margin: 0; padding: 0; text-align: center;
            user-select: none; -webkit-user-select: none;
            touch-action: manipulation; 
            overflow-x: hidden;
        }
        .container {
            max-width: 600px; margin: 0 auto; min-height: 100vh;
            background: #1e1e1e; padding: 20px; box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        h2 { color: #bb86fc; font-size: 26px; margin: 10px 0; text-shadow: 0 0 10px rgba(187, 134, 252, 0.5); }
        .sub-title { color: #03dac6; font-size: 14px; margin-bottom: 20px; letter-spacing: 1px; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            border: none; border-radius: 12px; padding: 15px 0; width: 100%;
            font-size: 16px; font-weight: bold; color: #000; cursor: pointer;
            transition: transform 0.1s; margin-bottom: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-main { background: linear-gradient(45deg, #6200ea, #bb86fc); color: #fff; font-size: 20px; padding: 25px 0; margin-bottom: 20px; }
        .btn-personal { background: linear-gradient(45deg, #00c853, #69f0ae); color: #000; font-size: 20px; padding: 25px 0; margin-bottom: 20px; }
        
        .btn-home { background: #444; color: #fff; margin-top: 20px; }
        .btn-retry { background: #ffeb3b; color: #000; margin-top: 10px; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        /* ê·¸ë£¹ ê²Œì„ ë²„íŠ¼ ìƒ‰ìƒ */
        .c-race { background: #ff7597; } .c-bomb { background: #ffb74d; }
        .c-tree { background: #aed581; } .c-bridge { background: #4fc3f7; }
        .c-pong { background: #ffeb3b; grid-column: span 2; }
        .c-draw { background: #ba68c8; grid-column: span 2; }

        /* ê°œì¸ ê²Œì„ ë²„íŠ¼ ìƒ‰ìƒ */
        .p-shoot { background: #ef5350; color:white; }
        .p-dodge { background: #42a5f5; color:white; }
        .p-soccer { background: #fff; color:#000; border: 2px solid #000;}
        .p-basket { background: #ff9800; color:#000; }

        /* í™”ë©´ ì „í™˜ */
        .scene { display: none; animation: fadeIn 0.3s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- ğŸ“‹ ê·¸ë£¹ ëª¨ë“œ UI --- */
        .roster-box { background: #2c2c2c; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; }
        textarea { width: 100%; height: 60px; background: #333; color: white; border: 1px solid #555; border-radius: 8px; box-sizing: border-box; }
        .player-tag { background: #3700b3; color: white; padding: 4px 10px; border-radius: 15px; font-size: 12px; margin-right: 5px; display: inline-block; margin-top:5px; }
        
        /* ê·¸ë£¹ ê²Œì„ ìš”ì†Œ */
        #track { background: #333; border-radius: 10px; padding: 10px 0; margin-top: 15px; }
        .lane { height: 40px; border-bottom: 1px dashed #555; position: relative; }
        .animal { position: absolute; left: 0; font-size: 24px; line-height: 40px; transition: left 0.1s linear; }
        
        /* --- ğŸ‘¤ ê°œì¸ ëª¨ë“œ UI --- */
        .game-canvas-box {
            position: relative; width: 100%; max-width: 400px; height: 400px; margin: 0 auto;
            background: #000; border: 2px solid #555; border-radius: 10px; overflow: hidden;
            touch-action: none;
        }
        canvas { display: block; width: 100%; height: 100%; }
        
        .score-board {
            position: absolute; top: 10px; left: 10px; font-size: 20px; font-weight: bold; color: #fff;
            text-shadow: 2px 2px 0 #000; z-index: 10; pointer-events: none;
        }
        .time-board {
            position: absolute; top: 10px; right: 10px; font-size: 20px; font-weight: bold; color: #ff5252;
            text-shadow: 2px 2px 0 #000; z-index: 10; pointer-events: none;
        }

        /* ì»¨íŠ¸ë¡¤ëŸ¬ (ë˜¥í”¼í•˜ê¸°ìš©) */
        .mobile-controls {
            display: flex; justify-content: space-between; margin-top: 10px; gap: 10px;
        }
        .control-btn {
            flex: 1; padding: 20px; background: #444; color: #fff; border-radius: 10px;
            font-size: 24px; border: none; touch-action: manipulation;
        }
        .control-btn:active { background: #666; }

        /* ê²°ê³¼ì°½ (ìº¡ì²˜ìš©) */
        .capture-card {
            background: #fff; color: #000; padding: 20px; border-radius: 15px; margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); text-align: center;
        }
        .capture-title { color: #555; font-size: 14px; margin-bottom: 5px; }
        .capture-score { font-size: 40px; font-weight: 900; color: #6200ea; margin: 10px 0; }
        .capture-rank { font-size: 16px; font-weight: bold; color: #ff5252; }

    </style>
</head>
<body>

<div class="container">

    <div id="scene-intro" class="scene active">
        <h1 style="font-size: 40px; margin-bottom: 30px;">ğŸ® GAME ZONE</h1>
        <button class="btn btn-main" onclick="goLobby()">ğŸ‘¥ ë‹¤ê°™ì´ í•˜ê¸°<br><span style="font-size:14px">(ë°©ì¥ ì§„í–‰ / ë‹¨ì²´ê²Œì„)</span></button>
        <button class="btn btn-personal" onclick="goPersonalMenu()">ğŸ‘¤ í˜¼ì í•˜ê¸°<br><span style="font-size:14px">(ê°œì¸ ê¸°ë¡ / ìº¡ì²˜ ê³µìœ )</span></button>
    </div>

    <div id="scene-lobby" class="scene">
        <h2>ğŸ‘¥ ë‹¨ì²´ ê²Œì„ ë¡œë¹„</h2>
        <div class="sub-title">HOST í™”ë©´ ê³µìœ  í•„ìˆ˜</div>
        
        <div class="roster-box">
            <div style="color:#aaa; font-size:12px;">ì°¸ê°€ì ëª…ë‹¨ (<span id="count">0</span>ëª…)</div>
            <textarea id="name-input" placeholder="ì´ë¦„ ì…ë ¥ (ì½¤ë§ˆë¡œ êµ¬ë¶„)"></textarea>
            <button class="btn" style="background:#03dac6; margin-top:5px;" onclick="updateRoster()">ëª…ë‹¨ ë“±ë¡</button>
            <div id="player-list-display"></div>
        </div>

        <div class="btn-grid">
            <button class="btn c-race" onclick="goGroupGame('race')">ğŸƒ ë‹¬ë¦¬ê¸°</button>
            <button class="btn c-bomb" onclick="goGroupGame('bomb')">ğŸ’£ í­íƒ„ì œê±°</button>
            <button class="btn c-tree" onclick="goGroupGame('tree')">ğŸŒ³ ë²„í‹°ê¸°</button>
            <button class="btn c-bridge" onclick="goGroupGame('bridge')">ğŸŒ‰ ìœ ë¦¬ë‹¤ë¦¬</button>
            <button class="btn c-pong" onclick="goGroupGame('pong')">ğŸ“ í•‘í</button>
            <button class="btn c-draw" onclick="goGroupGame('draw')">ğŸ² ë½‘ê¸°</button>
        </div>
        <button class="btn btn-home" onclick="goHome()">â¬… ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <div id="scene-group-game" class="scene">
        <h3 id="g-title">ê²Œì„ ì œëª©</h3>
        <div id="g-content"></div>
        <button class="btn" id="g-start-btn" style="background:#fff; margin-top:10px;" onclick="runGroupGame()">ì‹œì‘í•˜ê¸°</button>
        <div id="g-result" class="capture-card" style="display:none; background:#222; color:#fff;"></div>
        <button class="btn btn-home" onclick="goLobby()">ëª©ë¡ìœ¼ë¡œ</button>
    </div>


    <div id="scene-personal-menu" class="scene">
        <h2>ğŸ‘¤ ì‚¬ë‚´ ì˜¬ë¦¼í”½</h2>
        <p style="color:#aaa; font-size:13px;">ì¢…ëª©ì„ ì„ íƒí•˜ê³  ìµœê³  ê¸°ë¡ì— ë„ì „í•˜ì„¸ìš”!</p>
        
        <div class="btn-grid">
            <button class="btn p-soccer" onclick="startSoccerGame()">âš½ ìŠ¹ë¶€ì°¨ê¸°</button>
            <button class="btn p-basket" onclick="startBasketGame()">ğŸ€ ë†êµ¬</button>
            <button class="btn p-shoot" onclick="startShootingGame()">ğŸ”« ì‚¬ê²©</button>
            <button class="btn p-dodge" onclick="startDodgeGame()">â˜„ï¸ ë˜¥í”¼í•˜ê¸°</button>
        </div>

        <button class="btn btn-home" onclick="goHome()">â¬… ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <div id="scene-shooting" class="scene">
        <h3>ğŸ”« ìŠ¤ë‚˜ì´í¼ ì‚¬ê²©</h3>
        <p style="font-size:12px; color:#aaa;">ë‚˜íƒ€ë‚˜ëŠ” íƒ€ê²Ÿì„ ë¹ ë¥´ê²Œ í„°ì¹˜!</p>
        <div class="game-canvas-box">
            <canvas id="canvas-shoot"></canvas>
            <div class="score-board">SCORE: <span id="s-score">0</span></div>
            <div class="time-board">TIME: <span id="s-time">30</span></div>
        </div>
        <div id="res-shooting" class="capture-card" style="display:none">
            <div class="capture-title">ğŸ”« ì‚¬ê²© ê²°ê³¼</div>
            <div class="capture-score" id="final-s-score">0ì </div>
            <div style="font-size:11px; color:#888;">ìº¡ì²˜í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</div>
        </div>
        <button class="btn btn-retry" onclick="startShootingGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="btn btn-home" onclick="goPersonalMenu()">ë©”ë‰´ë¡œ</button>
    </div>

    <div id="scene-dodge" class="scene">
        <h3>â˜„ï¸ ì¥ì• ë¬¼ í”¼í•˜ê¸°</h3>
        <p style="font-size:12px; color:#aaa;">ë²„íŠ¼ì„ ëˆŒëŸ¬ í”¼í•˜ì„¸ìš”!</p>
        <div class="game-canvas-box">
            <canvas id="canvas-dodge"></canvas>
            <div class="score-board">SCORE: <span id="d-score">0</span></div>
        </div>
        <div class="mobile-controls">
            <button class="control-btn" ontouchstart="moveDodge('left')" onmousedown="moveDodge('left')" ontouchend="stopDodge()" onmouseup="stopDodge()">â¬…</button>
            <button class="control-btn" ontouchstart="moveDodge('right')" onmousedown="moveDodge('right')" ontouchend="stopDodge()" onmouseup="stopDodge()">â¡</button>
        </div>
        <div id="res-dodge" class="capture-card" style="display:none">
            <div class="capture-title">â˜„ï¸ ìƒì¡´ ê¸°ë¡</div>
            <div class="capture-score" id="final-d-score">0ì </div>
            <div style="font-size:11px; color:#888;">ìº¡ì²˜í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</div>
        </div>
        <button class="btn btn-retry" onclick="startDodgeGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="btn btn-home" onclick="goPersonalMenu()">ë©”ë‰´ë¡œ</button>
    </div>

    <div id="scene-soccer" class="scene">
        <h3>âš½ ìŠ¹ë¶€ì°¨ê¸° (PK)</h3>
        <p style="font-size:12px; color:#aaa;">ë¹ˆ ê³³ì„ ë…¸ë ¤ í„°ì¹˜í•˜ì„¸ìš”! (ê³¨í‚¤í¼ë¥¼ í”¼í•´ë¼)</p>
        <div class="game-canvas-box" style="background: #4caf50;">
            <canvas id="canvas-soccer"></canvas>
            <div class="score-board">GOAL: <span id="pk-score">0</span></div>
            <div class="time-board">TIME: <span id="pk-time">30</span></div>
        </div>
        <div id="res-soccer" class="capture-card" style="display:none">
            <div class="capture-title">âš½ ë“ì ì™•</div>
            <div class="capture-score" id="final-pk-score">0ê³¨</div>
            <div style="font-size:11px; color:#888;">ìº¡ì²˜í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</div>
        </div>
        <button class="btn btn-retry" onclick="startSoccerGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="btn btn-home" onclick="goPersonalMenu()">ë©”ë‰´ë¡œ</button>
    </div>

    <div id="scene-basket" class="scene">
        <h3>ğŸ€ ë†êµ¬ ìŠˆíŒ…</h3>
        <p style="font-size:12px; color:#aaa;">ê³¨ëŒ€ ê±°ë¦¬ë¥¼ ê³„ì‚°í•´ì„œ í„°ì¹˜! (í¬ë¬¼ì„ )</p>
        <div class="game-canvas-box" style="background: #37474f;">
            <canvas id="canvas-basket"></canvas>
            <div class="score-board">SCORE: <span id="bk-score">0</span></div>
            <div class="time-board">TIME: <span id="bk-time">30</span></div>
        </div>
        <div id="res-basket" class="capture-card" style="display:none">
            <div class="capture-title">ğŸ€ ë†êµ¬ ì²œì¬</div>
            <div class="capture-score" id="final-bk-score">0ì </div>
            <div style="font-size:11px; color:#888;">ìº¡ì²˜í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</div>
        </div>
        <button class="btn btn-retry" onclick="startBasketGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="btn btn-home" onclick="goPersonalMenu()">ë©”ë‰´ë¡œ</button>
    </div>

</div>

<script>
    /* ================= ê³µí†µ ë¡œì§ ================= */
    function goHome() { showScene('scene-intro'); stopAllGames(); }
    function goLobby() { showScene('scene-lobby'); stopAllGames(); }
    function goPersonalMenu() { showScene('scene-personal-menu'); stopAllGames(); }
    
    function showScene(id) {
        document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    
    function stopAllGames() {
        if(window.groupTimer) clearInterval(window.groupTimer);
        if(window.gameTimer) clearInterval(window.gameTimer);
        if(window.gameLoop) cancelAnimationFrame(window.gameLoop);
        window.isGameRunning = false;
    }

    /* ================= ê·¸ë£¹ ëª¨ë“œ ë¡œì§ ================= */
    let players = [];
    let curGroupGame = '';
    const animals = ['ğŸ¶','ğŸ±','ğŸ¹','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¸','ğŸ°'];

    function updateRoster() {
        const val = document.getElementById('name-input').value;
        players = val.split(/[,|\n]+/).map(n=>n.trim()).filter(n=>n);
        const div = document.getElementById('player-list-display');
        div.innerHTML = '';
        players.forEach(p => div.innerHTML += `<span class="player-tag">${p}</span>`);
        document.getElementById('count').innerText = players.length;
        if(players.length>0) alert("ë“±ë¡ ì™„ë£Œ!");
    }

    function goGroupGame(type) {
        if(players.length < 2) return alert("ì°¸ê°€ì ëª…ë‹¨ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!");
        curGroupGame = type;
        showScene('scene-group-game');
        document.getElementById('g-result').style.display='none';
        const content = document.getElementById('g-content');
        const title = document.getElementById('g-title');
        const btn = document.getElementById('g-start-btn');
        btn.style.display = 'block';
        content.innerHTML = '';

        if(type==='race') { title.innerText='ğŸƒ ë‹¬ë¦¬ê¸°'; content.innerHTML='<div id="track" style="background:#333; padding:10px;"></div>'; initRaceUI(); }
        else if(type==='bomb') { title.innerText='ğŸ’£ í­íƒ„ í•´ì²´'; content.innerHTML='<div style="font-size:50px;">ğŸ’£</div><div id="wires" style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-top:20px;"></div>'; initBombUI(); }
        else if(type==='tree') { title.innerText='ğŸŒ³ ë²„í‹°ê¸°'; content.innerHTML='<div style="height:200px; background:#2e7d32; position:relative; border-radius:10px;" id="tree-bg"></div>'; initTreeUI(); }
        else if(type==='bridge') { title.innerText='ğŸŒ‰ ìœ ë¦¬ë‹¤ë¦¬'; content.innerHTML='<div id="bridge-box" style="height:300px; background:#000; overflow-y:auto; padding:10px;"></div>'; document.getElementById('bridge-box').innerHTML='<div style="color:#aaa">ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìƒì„±ë©ë‹ˆë‹¤</div>'; btn.onclick=startBridge; }
        else if(type==='pong') { title.innerText='ğŸ“ í•‘í'; content.innerHTML='<canvas id="pong-c" width="300" height="300" style="background:#000; border:1px solid #ffeb3b;"></canvas>'; btn.onclick=startPong; }
        else if(type==='draw') { title.innerText='ğŸ² ì œë¹„ë½‘ê¸°'; content.innerHTML='<div id="draw-box" style="display:flex; flex-wrap:wrap; justify-content:center; gap:5px;"></div>'; initDrawUI(); }
    }

    function runGroupGame() {
        if(curGroupGame==='race') startRace();
        if(curGroupGame==='bomb') alert("ê°€ìœ„ë°”ìœ„ë³´ ì§„ ì‚¬ëŒë¶€í„° ì„ ì„ í•˜ë‚˜ì”© ëˆ„ë¥´ì„¸ìš”!");
        if(curGroupGame==='tree') startTree();
        if(curGroupGame==='draw') startDraw();
        // bridge, pongì€ ê°œë³„ start í•¨ìˆ˜ ìˆìŒ
    }

    // -- ê·¸ë£¹ ê²Œì„ UI/ë¡œì§ (ì¶•ì•½) --
    function initRaceUI(){const t=document.querySelector('#track');t.innerHTML='<div style="position:absolute; right:10px; height:100%; width:2px; background:red;"></div>';players.forEach((p,i)=>t.innerHTML+=`<div class="lane"><span id="r-${i}" class="animal">${animals[i%8]}</span><small style="margin-left:30px">${p}</small></div>`)}
    function startRace(){document.getElementById('g-start-btn').style.display='none';let racers=players.map((p,i)=>({id:i,n:p,x:0}));window.groupTimer=setInterval(()=>{let done=true;racers.forEach(r=>{if(r.x<90){done=false;r.x+=Math.random()*2;document.getElementById(`r-${r.id}`).style.left=r.x+'%'}});if(done){clearInterval(window.groupTimer);showGroupResult(racers.sort((a,b)=>b.x-a.x).map(r=>r.n));}},50)}
    function initBombUI(){const w=document.getElementById('wires');let bomb=Math.floor(Math.random()*players.length);players.forEach((p,i)=>{w.innerHTML+=`<button onclick="if(${i}===${bomb}){alert('ì¾…!');showGroupResult(['${p} (íƒˆë½)']);}else{this.style.opacity=0.3;this.innerText='í†µê³¼'}" style="padding:10px; flex:1 0 40%;">${p}</button>`})}
    function initTreeUI(){const t=document.getElementById('tree-bg');players.forEach((p,i)=>{t.innerHTML+=`<div id="f-${i}" style="position:absolute; top:${Math.random()*100}px; left:${Math.random()*250}px; background:orange; width:30px; height:30px; border-radius:50%; line-height:30px; font-size:10px;">${p}</div>`})}
    function startTree(){let fallen=0,res=[];let times=players.map(p=>({n:p,t:Math.random()*4000+1000})).sort((a,b)=>a.t-b.t);times.forEach(x=>{setTimeout(()=>{const el=[...document.querySelectorAll('div[id^="f-"]')].find(e=>e.innerText==x.n);if(el){el.style.top='170px';el.style.background='#555';fallen++;res.push(x.n);if(fallen==players.length)showGroupResult(res.reverse())}},x.t)})}
    function initDrawUI(){const d=document.getElementById('draw-box');players.forEach(p=>d.innerHTML+='<div class="card" style="width:60px;height:80px;background:#ba68c8;margin:5px;display:flex;align-items:center;justify-content:center;">?</div>')}
    function startDraw(){const d=document.getElementById('draw-box');d.innerHTML='';[...players].sort(()=>Math.random()-0.5).forEach((p,i)=>{setTimeout(()=>{d.innerHTML+=`<div style="width:60px;height:80px;background:#fff;color:#000;margin:5px;border:1px solid #ba68c8;display:flex;align-items:center;justify-content:center;font-size:12px;">${i+1}ë“±<br>${p}</div>`},i*500)})}
    function startBridge(){alert("MCê°€ ì§„í–‰í•´ì£¼ì„¸ìš”!");} function startPong(){alert("MCê°€ ì§„í–‰í•´ì£¼ì„¸ìš”!");}
    function showGroupResult(list){const r=document.getElementById('g-result'); r.style.display='block'; r.innerHTML=`<h3>ğŸ† ê²°ê³¼</h3><div style="font-size:20px; color:gold;">1ìœ„: ${list[0]}</div>`+(list[1]?`<div>2ìœ„: ${list[1]}</div>`:'');}


    /* ================= ğŸ‘¤ ê°œì¸ ëª¨ë“œ: ì‚¬ê²© ================= */
    let sScore = 0;
    let targets = [];
    
    function startShootingGame() {
        showScene('scene-shooting');
        document.getElementById('res-shooting').style.display = 'none';
        sScore = 0; 
        document.getElementById('s-score').innerText = 0;
        let time = 30;
        document.getElementById('s-time').innerText = time;
        
        const canvas = document.getElementById('canvas-shoot');
        canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
        const ctx = canvas.getContext('2d');
        targets = [];

        canvas.onmousedown = canvas.ontouchstart = function(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const x = clientX - rect.left; const y = clientY - rect.top;
            
            for (let i = targets.length - 1; i >= 0; i--) {
                const t = targets[i];
                if (Math.sqrt((x - t.x)**2 + (y - t.y)**2) < t.r) {
                    sScore += 10 + Math.floor((30 - t.r));
                    document.getElementById('s-score').innerText = sScore;
                    targets.splice(i, 1); createTarget(canvas.width, canvas.height);
                    return;
                }
            }
        };

        window.isGameRunning = true;
        window.gameTimer = setInterval(() => { time--; document.getElementById('s-time').innerText = time; if(time <= 0) endShooting(); }, 1000);

        function loop() {
            if(!window.isGameRunning) return;
            ctx.fillStyle = '#000'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            if(targets.length < 3) createTarget(canvas.width, canvas.height);
            targets.forEach(t => {
                t.life--; ctx.beginPath(); ctx.arc(t.x, t.y, t.r, 0, Math.PI*2);
                ctx.fillStyle = t.color; ctx.fill(); ctx.strokeStyle='#fff'; ctx.stroke();
            });
            targets = targets.filter(t => t.life > 0);
            window.gameLoop = requestAnimationFrame(loop);
        }
        loop();
    }
    function createTarget(w, h) { targets.push({ x: Math.random()*(w-60)+30, y: Math.random()*(h-60)+30, r: Math.random()*20+15, life: 100, color: `hsl(${Math.random()*360},70%,50%)` }); }
    function endShooting() { stopAllGames(); document.getElementById('res-shooting').style.display = 'block'; document.getElementById('final-s-score').innerText = sScore + "ì "; }


    /* ================= ğŸ‘¤ ê°œì¸ ëª¨ë“œ: ë˜¥í”¼í•˜ê¸° ================= */
    let dScore=0, playerX=0, moveDir=0, meteors=[];
    function startDodgeGame() {
        showScene('scene-dodge');
        document.getElementById('res-dodge').style.display = 'none';
        dScore=0; document.getElementById('d-score').innerText = 0;
        const canvas = document.getElementById('canvas-dodge');
        canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
        const ctx = canvas.getContext('2d');
        playerX = canvas.width / 2; meteors = [];
        window.isGameRunning = true;
        
        function loop() {
            if(!window.isGameRunning) return;
            dScore++; document.getElementById('d-score').innerText = dScore;
            ctx.fillStyle = '#111'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            playerX += moveDir * 5; 
            if(playerX < 15) playerX = 15; if(playerX > canvas.width - 15) playerX = canvas.width - 15;
            
            ctx.fillStyle = '#00e676'; ctx.beginPath();
            ctx.moveTo(playerX, canvas.height-40); ctx.lineTo(playerX-15, canvas.height-10); ctx.lineTo(playerX+15, canvas.height-10); ctx.fill();

            if(dScore % 20 === 0) meteors.push({x:Math.random()*canvas.width, y:-20, r:Math.random()*10+5, s:Math.random()*3+3+(dScore/2000)});
            
            meteors.forEach(m => {
                m.y += m.s; ctx.fillStyle = '#ff5252'; ctx.beginPath(); ctx.arc(m.x, m.y, m.r, 0, Math.PI*2); ctx.fill();
                if(Math.abs(m.x-playerX) < (m.r+10) && Math.abs(m.y-(canvas.height-20)) < (m.r+10)) endDodge();
            });
            window.gameLoop = requestAnimationFrame(loop);
        }
        loop();
    }
    function moveDodge(dir) { moveDir = dir==='left' ? -1 : 1; } function stopDodge() { moveDir = 0; }
    function endDodge() { stopAllGames(); document.getElementById('res-dodge').style.display = 'block'; document.getElementById('final-d-score').innerText = dScore + "ì "; }


    /* ================= ğŸ‘¤ ê°œì¸ ëª¨ë“œ: ìŠ¹ë¶€ì°¨ê¸° (NEW) ================= */
    let pkScore = 0;
    let gkX = 0, gkDir = 1;
    let soccerBall = null; // {x, y, vx, vy}
    
    function startSoccerGame() {
        showScene('scene-soccer');
        document.getElementById('res-soccer').style.display = 'none';
        pkScore = 0; document.getElementById('pk-score').innerText = 0;
        let time = 30; document.getElementById('pk-time').innerText = time;

        const canvas = document.getElementById('canvas-soccer');
        canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
        const ctx = canvas.getContext('2d');
        const goalW = 160; const goalH = 10;
        
        gkX = canvas.width/2; 
        soccerBall = { x: canvas.width/2, y: canvas.height-30, active: false };
        window.isGameRunning = true;

        // í„°ì¹˜ë¡œ ìŠ›
        canvas.onmousedown = canvas.ontouchstart = function(e) {
            e.preventDefault();
            if(!window.isGameRunning || soccerBall.active) return;
            
            const rect = canvas.getBoundingClientRect();
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            const touchX = cx - rect.left;
            const touchY = cy - rect.top;

            // ë²¡í„° ê³„ì‚°
            const dx = touchX - soccerBall.x;
            const dy = touchY - soccerBall.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const speed = 15;
            
            soccerBall.vx = (dx / dist) * speed;
            soccerBall.vy = (dy / dist) * speed;
            soccerBall.active = true;
        };

        window.gameTimer = setInterval(() => { time--; document.getElementById('pk-time').innerText = time; if(time <= 0) endSoccer(); }, 1000);

        function loop() {
            if(!window.isGameRunning) return;
            // ë°°ê²½
            ctx.fillStyle = '#4caf50'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            // ê³¨ëŒ€
            ctx.fillStyle = '#fff'; ctx.fillRect(canvas.width/2 - goalW/2, 20, goalW, goalH);
            
            // í‚¤í¼ ì´ë™
            gkX += 3 * gkDir;
            if(gkX < canvas.width/2 - goalW/2 + 20 || gkX > canvas.width/2 + goalW/2 - 20) gkDir *= -1;
            
            // í‚¤í¼ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#ff9800'; ctx.beginPath(); ctx.arc(gkX, 40, 20, 0, Math.PI*2); ctx.fill(); // ë¨¸ë¦¬
            ctx.fillRect(gkX-20, 40, 40, 20); // ëª¸í†µ

            // ê³µ ì²˜ë¦¬
            if(soccerBall.active) {
                soccerBall.x += soccerBall.vx;
                soccerBall.y += soccerBall.vy;
                soccerBall.r = 10;

                // ê³¨ë¼ì¸ í†µê³¼ ì²´í¬
                if(soccerBall.y < 30) {
                    // í‚¤í¼ ì¶©ëŒ ì²´í¬
                    if(Math.abs(soccerBall.x - gkX) < 30) {
                        // ë§‰í˜
                        resetBall();
                    } else if(soccerBall.x > canvas.width/2 - goalW/2 && soccerBall.x < canvas.width/2 + goalW/2) {
                        // ê³¨!
                        pkScore++; document.getElementById('pk-score').innerText = pkScore;
                        resetBall();
                    } else {
                        // ë¹—ë‚˜ê°
                        resetBall();
                    }
                }
                // í™”ë©´ ë°–
                if(soccerBall.y < 0 || soccerBall.x < 0 || soccerBall.x > canvas.width) resetBall();
            }

            // ê³µ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#fff'; ctx.beginPath(); 
            ctx.arc(soccerBall.x, soccerBall.y, 10, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle='#000'; ctx.stroke();

            window.gameLoop = requestAnimationFrame(loop);
        }
        loop();

        function resetBall() {
            soccerBall = { x: canvas.width/2, y: canvas.height-30, active: false };
        }
    }
    function endSoccer() { stopAllGames(); document.getElementById('res-soccer').style.display = 'block'; document.getElementById('final-pk-score').innerText = pkScore + "ê³¨"; }


    /* ================= ğŸ‘¤ ê°œì¸ ëª¨ë“œ: ë†êµ¬ (NEW) ================= */
    let bkScore = 0;
    let hoopX = 0, hoopDir = 1;
    let ball = null; // {x, y, vx, vy}

    function startBasketGame() {
        showScene('scene-basket');
        document.getElementById('res-basket').style.display = 'none';
        bkScore = 0; document.getElementById('bk-score').innerText = 0;
        let time = 30; document.getElementById('bk-time').innerText = time;

        const canvas = document.getElementById('canvas-basket');
        canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
        const ctx = canvas.getContext('2d');
        
        hoopX = canvas.width / 2;
        ball = { x: 50, y: canvas.height-50, active: false };
        window.isGameRunning = true;

        canvas.onmousedown = canvas.ontouchstart = function(e) {
            e.preventDefault();
            if(!window.isGameRunning || ball.active) return;
            
            const rect = canvas.getBoundingClientRect();
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            
            // ê³µ ìœ„ì¹˜ì—ì„œ í„°ì¹˜ ìœ„ì¹˜ë¡œì˜ ë²¡í„°ë¡œ ë°œì‚¬ (í¬ë¬¼ì„ )
            const tx = cx - rect.left;
            const ty = cy - rect.top;
            
            const dx = tx - ball.x;
            const dy = ty - ball.y;
            
            ball.vx = dx * 0.15; // íŒŒì›Œ ì¡°ì ˆ
            ball.vy = dy * 0.15;
            ball.active = true;
        };

        window.gameTimer = setInterval(() => { time--; document.getElementById('bk-time').innerText = time; if(time <= 0) endBasket(); }, 1000);

        function loop() {
            if(!window.isGameRunning) return;
            ctx.fillStyle = '#37474f'; ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ê³¨ëŒ€ ì´ë™
            hoopX += 2 * hoopDir;
            if(hoopX < 50 || hoopX > canvas.width - 50) hoopDir *= -1;

            // ê³¨ëŒ€ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#ef5350'; ctx.fillRect(hoopX-25, 100, 50, 5); // ë¦¼
            ctx.strokeStyle = '#fff'; ctx.beginPath(); ctx.moveTo(hoopX-25, 100); 
            ctx.lineTo(hoopX-15, 150); ctx.lineTo(hoopX+15, 150); ctx.lineTo(hoopX+25, 100); ctx.stroke(); // ê·¸ë¬¼

            // ê³µ ë¬¼ë¦¬
            if(ball.active) {
                ball.x += ball.vx;
                ball.y += ball.vy;
                ball.vy += 0.5; // ì¤‘ë ¥

                // ê³¨ì¸ ì²´í¬ (ë¦¼ ê·¼ì²˜ì—ì„œ ë‚´ë ¤ì˜¬ ë•Œ)
                if(ball.vy > 0 && Math.abs(ball.y - 100) < 10 && Math.abs(ball.x - hoopX) < 20) {
                    bkScore += 2; document.getElementById('bk-score').innerText = bkScore;
                    // ê³¨ ì´í™íŠ¸ (ê°„ë‹¨íˆ)
                    ctx.fillStyle = 'gold'; ctx.font = '20px Arial'; ctx.fillText("+2", hoopX, 80);
                    resetBall();
                }

                // ë°”ë‹¥ì´ë‚˜ ë²½ ë‹¿ìœ¼ë©´ ë¦¬ì…‹
                if(ball.y > canvas.height || ball.x > canvas.width || ball.x < 0) resetBall();
            } else {
                // ëŒ€ê¸° ì¤‘ì¸ ê³µì€ ë”°ë¼ë‹¤ë‹˜ (ìŠˆíŒ… ìœ„ì¹˜ ëœë¤í™”)
                // ball.x = ... 
            }

            // ê³µ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#ff9800'; ctx.beginPath(); ctx.arc(ball.x, ball.y, 12, 0, Math.PI*2); ctx.fill();

            window.gameLoop = requestAnimationFrame(loop);
        }
        loop();

        function resetBall() {
            ball = { x: Math.random() * (canvas.width-40) + 20, y: canvas.height-50, active: false, vx:0, vy:0 };
        }
    }
    function endBasket() { stopAllGames(); document.getElementById('res-basket').style.display = 'block'; document.getElementById('final-bk-score').innerText = bkScore + "ì "; }

</script>
</body>
</html>
