<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOA LAB COMPANY</title>
    <style>
        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            text-align: center;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        h2 { color: #1a73e8; margin-bottom: 10px; }
        .input-group { margin-bottom: 20px; }
        input[type="text"] {
            width: 80%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;
        }
        .btn {
            background-color: #1a73e8; color: white; border: none; padding: 12px 20px;
            font-size: 16px; border-radius: 10px; cursor: pointer; margin: 5px;
            transition: 0.2s; width: 100%; max-width: 200px;
        }
        .btn:hover { background-color: #1557b0; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .btn-green { background-color: #34a853; }
        .btn-red { background-color: #ea4335; }
        .btn-home { background-color: #5f6368; margin-top: 20px; }

        /* í™”ë©´ ì „í™˜ìš© */
        .scene { display: none; }
        .active { display: block; }

        /* --- ê²Œì„ 1: ë‹¬ë¦¬ê¸° ìŠ¤íƒ€ì¼ --- */
        #track { width: 100%; border: 2px solid #eee; background: #fafafa; position: relative; border-radius: 10px; overflow: hidden; margin-top:10px;}
        .lane { height: 50px; border-bottom: 1px dashed #eee; position: relative; }
        .animal { position: absolute; left: 0; font-size: 30px; transition: left 0.1s linear; line-height: 50px;}
        .finish-line { position: absolute; right: 10px; top: 0; bottom: 0; width: 4px; background: rgba(255,0,0,0.3); z-index: 1;}

        /* --- ê²Œì„ 2: ì œë¹„ë½‘ê¸° ìŠ¤íƒ€ì¼ --- */
        .card-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
        .card {
            width: 80px; height: 100px; background: #1a73e8; color: white;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; cursor: pointer; transition: transform 0.5s;
        }
        .card.flipped { background: #fff; color: #333; border: 2px solid #1a73e8; transform: rotateY(180deg); }

        /* --- ê²Œì„ 3: ë²„í‹°ëŠ” ì—´ë§¤ ìŠ¤íƒ€ì¼ --- */
        #tree-area {
            height: 350px; position: relative; background: #e8f5e9; border-radius: 15px; overflow: hidden; margin-top: 10px;
        }
        #tree-trunk {
            width: 40px; height: 100px; background: #795548; margin: 0 auto;
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
        }
        #tree-leaves {
            width: 280px; height: 200px; background: #4caf50; border-radius: 50% 50% 40% 40%;
            position: absolute; bottom: 90px; left: 50%; transform: translateX(-50%);
            z-index: 1;
        }
        .shaking { animation: shake 0.5s infinite; }
        @keyframes shake {
            0% { transform: translateX(-50%) rotate(0deg); }
            25% { transform: translateX(-50%) rotate(-5deg); }
            50% { transform: translateX(-50%) rotate(0deg); }
            75% { transform: translateX(-50%) rotate(5deg); }
            100% { transform: translateX(-50%) rotate(0deg); }
        }
        .fruit {
            position: absolute; width: 50px; height: 50px; background: #ff7043; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 12px; color: white; font-weight: bold;
            z-index: 2; transition: top 0.5s ease-in; box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        .fallen { background: #bdbdbd; } /* ë–¨ì–´ì§„ ì—´ë§¤ ìƒ‰ */

        /* ê²°ê³¼ì°½ */
        .result-box { margin-top: 20px; padding: 15px; background: #e8f0fe; border-radius: 10px; text-align: left; }
        .rank-item { padding: 5px; border-bottom: 1px solid #dcdcdc; }
        .rank-1 { color: #d93025; font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>

    <div class="container">
        <div id="scene-menu" class="scene active">
            <h2>ğŸ® ì‚¬ë‚´ ë¯¸ë‹ˆê²Œì„ ì²œêµ­</h2>
            <div class="input-group">
                <p>ì°¸ê°€ì ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„)</p>
                <input type="text" id="global-names" value="ê¹€ëŒ€ë¦¬,ì´ê³¼ì¥,ë°•ì‚¬ì›,ìµœíŒ€ì¥" placeholder="ì´ë¦„ ì…ë ¥">
            </div>
            <button class="btn" onclick="goToGame('race')">ğŸƒ í”½ì…€ ë‹¬ë¦¬ê¸°</button><br>
            <button class="btn btn-green" onclick="goToGame('draw')">ğŸ² ëœë¤ ì œë¹„ë½‘ê¸°</button><br>
            <button class="btn btn-red" onclick="goToGame('fruit')">ğŸŒ³ ë²„í‹°ëŠ” ì—´ë§¤</button>
        </div>

        <div id="scene-race" class="scene">
            <h3>ğŸƒ í”½ì…€ ëœë¤ ë‹¬ë¦¬ê¸°</h3>
            <div id="track"></div>
            <button class="btn" id="btn-race-start" onclick="startRace()">ë‹¬ë ¤ë¼!!</button>
            <div id="race-result" class="result-box" style="display:none;"></div>
            <button class="btn btn-home" onclick="goHome()">ë©”ì¸ìœ¼ë¡œ</button>
        </div>

        <div id="scene-draw" class="scene">
            <h3>ğŸ² ìš´ëª…ì˜ ì œë¹„ë½‘ê¸°</h3>
            <p>ì¹´ë“œê°€ ì„ì´ê³  ìˆìŠµë‹ˆë‹¤...</p>
            <div id="draw-area" class="card-grid"></div>
            <button class="btn" id="btn-draw-start" onclick="startDraw()">ë½‘ê¸° ì‹œì‘!</button>
            <div id="draw-result" class="result-box" style="display:none;"></div>
            <button class="btn btn-home" onclick="goHome()">ë©”ì¸ìœ¼ë¡œ</button>
        </div>

        <div id="scene-fruit" class="scene">
            <h3>ğŸŒ³ ìµœí›„ì˜ ì—´ë§¤ëŠ” ëˆ„êµ¬?</h3>
            <p>ê°€ì¥ ëŠ¦ê²Œ ë–¨ì–´ì§€ëŠ” ì‚¬ëŒì´ 1ë“±!</p>
            <div id="tree-area">
                <div id="tree-leaves"></div>
                <div id="tree-trunk"></div>
            </div>
            <button class="btn btn-red" id="btn-fruit-start" onclick="startFruit()">ë‚˜ë¬´ í”ë“¤ê¸°!!</button>
            <div id="fruit-result" class="result-box" style="display:none;"></div>
            <button class="btn btn-home" onclick="goHome()">ë©”ì¸ìœ¼ë¡œ</button>
        </div>
    </div>

    <script>
        // ê³µí†µ ë³€ìˆ˜
        let participants = [];
        const animals = ['ğŸ¶','ğŸ±','ğŸ¹','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¸','ğŸ°'];

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function goHome() {
            document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));
            document.getElementById('scene-menu').classList.add('active');
        }

        function goToGame(gameType) {
            const input = document.getElementById('global-names').value;
            participants = input.split(',').map(n => n.trim()).filter(n => n);
            
            if (participants.length < 2) {
                alert("ìµœì†Œ 2ëª… ì´ìƒì˜ ì°¸ê°€ìê°€ í•„ìš”í•©ë‹ˆë‹¤!");
                return;
            }

            document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));
            document.getElementById(`scene-${gameType}`).classList.add('active');

            // ê²Œì„ë³„ ì´ˆê¸°í™”
            if (gameType === 'race') initRace();
            if (gameType === 'draw') initDraw();
            if (gameType === 'fruit') initFruit();
        }

        // --- 1. ë‹¬ë¦¬ê¸° ê²Œì„ ë¡œì§ ---
        let raceInterval;
        function initRace() {
            const track = document.getElementById('track');
            track.innerHTML = '<div class="finish-line"></div>';
            document.getElementById('race-result').style.display = 'none';
            document.getElementById('btn-race-start').disabled = false;
            
            participants.forEach((name, i) => {
                const lane = document.createElement('div');
                lane.className = 'lane';
                lane.innerHTML = `<span id="racer-${i}" class="animal" style="left:0%">${animals[i%animals.length]}</span> <small style="margin-left:5px">${name}</small>`;
                track.appendChild(lane);
            });
        }

        function startRace() {
            document.getElementById('btn-race-start').disabled = true;
            let racers = participants.map((name, i) => ({ id: i, name: name, pos: 0, finished: false }));
            let rank = [];
            
            raceInterval = setInterval(() => {
                let allFinished = true;
                racers.forEach(r => {
                    if (!r.finished) {
                        allFinished = false;
                        let move = Math.random() * 2 + 0.5;
                        if(Math.random() > 0.95) move += 5; // ë¶€ìŠ¤í„°
                        r.pos += move;
                        if (r.pos >= 90) {
                            r.pos = 90;
                            r.finished = true;
                            rank.push(r.name);
                        }
                        document.getElementById(`racer-${r.id}`).style.left = r.pos + '%';
                    }
                });

                if (allFinished) {
                    clearInterval(raceInterval);
                    showResult('race-result', rank);
                }
            }, 50);
        }

        // --- 2. ì œë¹„ë½‘ê¸° ë¡œì§ ---
        function initDraw() {
            const area = document.getElementById('draw-area');
            area.innerHTML = '';
            document.getElementById('draw-result').style.display = 'none';
            document.getElementById('btn-draw-start').disabled = false;

            participants.forEach((name, i) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = '?';
                area.appendChild(card);
            });
        }

        function startDraw() {
            document.getElementById('btn-draw-start').disabled = true;
            const area = document.getElementById('draw-area');
            area.innerHTML = ''; // ê¸°ì¡´ ì¹´ë“œ ì§€ì›€
            
            // ì…”í”Œ
            let shuffled = [...participants].sort(() => Math.random() - 0.5);
            let delay = 0;

            shuffled.forEach((name, i) => {
                // ì‹œê°ì  ì¹´ë“œ ìƒì„±
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = '?';
                area.appendChild(card);

                // ìˆœì°¨ì ìœ¼ë¡œ ë’¤ì§‘ê¸°
                setTimeout(() => {
                    card.classList.add('flipped');
                    card.innerText = `${i+1}ë“±\n${name}`;
                }, i * 800 + 500);
            });

            setTimeout(() => {
                showResult('draw-result', shuffled);
            }, participants.length * 800 + 1000);
        }

        // --- 3. ë²„í‹°ëŠ” ì—´ë§¤ ë¡œì§ ---
        function initFruit() {
            const tree = document.getElementById('tree-leaves');
            tree.innerHTML = ''; // ì´ˆê¸°í™”
            tree.classList.remove('shaking');
            document.getElementById('fruit-result').style.display = 'none';
            document.getElementById('btn-fruit-start').disabled = false;

            participants.forEach((name, i) => {
                const fruit = document.createElement('div');
                fruit.className = 'fruit';
                fruit.id = `fruit-${i}`;
                fruit.innerText = name;
                // ëœë¤ ìœ„ì¹˜ (ë‚˜ë¬´ ìì‚¬ê·€ ë²”ìœ„ ì•ˆ)
                fruit.style.left = (Math.random() * 200 + 20) + 'px'; 
                fruit.style.top = (Math.random() * 120 + 20) + 'px';
                tree.appendChild(fruit);
            });
        }

        function startFruit() {
            document.getElementById('btn-fruit-start').disabled = true;
            const tree = document.getElementById('tree-leaves');
            tree.classList.add('shaking'); // ë‚˜ë¬´ í”ë“¤ê¸° ì‹œì‘

            let fallenCount = 0;
            let fallOrder = []; // ë–¨ì–´ì§„ ìˆœì„œ (1ë“±ì´ ê°€ì¥ ë‚˜ì¤‘)
            
            // ê° ì—´ë§¤ë§ˆë‹¤ ë–¨ì–´ì§€ëŠ” ì‹œê°„ ëœë¤ ë°°ì • (1ì´ˆ ~ 5ì´ˆ ì‚¬ì´)
            participants.forEach((name, i) => {
                const fruit = document.getElementById(`fruit-${i}`);
                const fallTime = Math.random() * 4000 + 1000; // ë²„í‹°ëŠ” ì‹œê°„

                setTimeout(() => {
                    // ë–¨ì–´ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜
                    fruit.style.top = '300px'; 
                    fruit.classList.add('fallen');
                    fallOrder.push(name);
                    fallenCount++;

                    // ëª¨ë‘ ë–¨ì–´ì§€ë©´ ê²°ê³¼ ë°œí‘œ
                    if (fallenCount === participants.length) {
                        tree.classList.remove('shaking');
                        // ë–¨ì–´ì§„ ìˆœì„œì˜ ì—­ìˆœì´ ìˆœìœ„ (ë‚˜ì¤‘ì— ë–¨ì–´ì§„ê²Œ 1ë“±)
                        const rank = fallOrder.reverse(); 
                        showResult('fruit-result', rank);
                    }
                }, fallTime);
            });
        }

        // --- ê³µí†µ ê²°ê³¼ ì¶œë ¥ í•¨ìˆ˜ ---
        function showResult(elementId, rankList) {
            const box = document.getElementById(elementId);
            box.style.display = 'block';
            let html = "<h4>ğŸ† ê²°ê³¼ ë°œí‘œ</h4>";
            rankList.forEach((name, i) => {
                const style = i === 0 ? "rank-1" : "";
                html += `<div class="rank-item ${style}">${i+1}ë“± : ${name}</div>`;
            });
            box.innerHTML = html;
        }

    </script>
</body>
</html>
