<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì‚¬ë‚´ ë¯¸ë‹ˆê²Œì„ LIVE (í†µí•©íŒ)</title>
    <style>
        /* --- ê³µí†µ ìŠ¤íƒ€ì¼ (ë‹¤í¬ëª¨ë“œ) --- */
        body {
            font-family: 'Suit', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #121212; color: #fff;
            margin: 0; padding: 0; text-align: center;
            user-select: none; -webkit-user-select: none;
            touch-action: manipulation; /* ì¤Œ ë°©ì§€ */
            overflow-x: hidden;
        }
        .container {
            max-width: 600px; margin: 0 auto; min-height: 100vh;
            background: #1e1e1e; padding: 20px; box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        h2 { color: #bb86fc; font-size: 26px; margin: 10px 0; text-shadow: 0 0 10px rgba(187, 134, 252, 0.5); }
        .sub-title { color: #03dac6; font-size: 14px; margin-bottom: 20px; letter-spacing: 1px; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            border: none; border-radius: 12px; padding: 15px 0; width: 100%;
            font-size: 16px; font-weight: bold; color: #000; cursor: pointer;
            transition: transform 0.1s; margin-bottom: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-main { background: linear-gradient(45deg, #6200ea, #bb86fc); color: #fff; font-size: 20px; padding: 25px 0; margin-bottom: 20px; }
        .btn-personal { background: linear-gradient(45deg, #00c853, #69f0ae); color: #000; font-size: 20px; padding: 25px 0; margin-bottom: 20px; }
        
        .btn-home { background: #444; color: #fff; margin-top: 20px; }
        .btn-retry { background: #ffeb3b; color: #000; margin-top: 10px; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .c-race { background: #ff7597; } .c-bomb { background: #ffb74d; }
        .c-tree { background: #aed581; } .c-bridge { background: #4fc3f7; }
        .c-pong { background: #ffeb3b; grid-column: span 2; }
        .c-draw { background: #ba68c8; grid-column: span 2; }

        /* í™”ë©´ ì „í™˜ */
        .scene { display: none; animation: fadeIn 0.3s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- ğŸ“‹ ê·¸ë£¹ ëª¨ë“œ ìŠ¤íƒ€ì¼ --- */
        .roster-box { background: #2c2c2c; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; }
        textarea { width: 100%; height: 60px; background: #333; color: white; border: 1px solid #555; border-radius: 8px; box-sizing: border-box; }
        .player-tag { background: #3700b3; color: white; padding: 4px 10px; border-radius: 15px; font-size: 12px; margin-right: 5px; display: inline-block; margin-top:5px; }
        
        /* ê·¸ë£¹ ê²Œì„ ìš”ì†Œ (ê°„ëµí™”) */
        #track { background: #333; border-radius: 10px; padding: 10px 0; margin-top: 15px; }
        .lane { height: 40px; border-bottom: 1px dashed #555; position: relative; }
        .animal { position: absolute; left: 0; font-size: 24px; line-height: 40px; transition: left 0.1s linear; }
        
        /* --- ğŸ‘¤ ê°œì¸ ëª¨ë“œ ìŠ¤íƒ€ì¼ --- */
        .game-canvas-box {
            position: relative; width: 100%; max-width: 400px; height: 400px; margin: 0 auto;
            background: #000; border: 2px solid #555; border-radius: 10px; overflow: hidden;
            touch-action: none;
        }
        canvas { display: block; width: 100%; height: 100%; }
        
        .score-board {
            position: absolute; top: 10px; left: 10px; font-size: 20px; font-weight: bold; color: #fff;
            text-shadow: 2px 2px 0 #000; z-index: 10; pointer-events: none;
        }
        .time-board {
            position: absolute; top: 10px; right: 10px; font-size: 20px; font-weight: bold; color: #ff5252;
            text-shadow: 2px 2px 0 #000; z-index: 10; pointer-events: none;
        }

        /* ì»¨íŠ¸ë¡¤ëŸ¬ (ëª¨ë°”ì¼ìš©) */
        .mobile-controls {
            display: flex; justify-content: space-between; margin-top: 10px; gap: 10px;
        }
        .control-btn {
            flex: 1; padding: 20px; background: #444; color: #fff; border-radius: 10px;
            font-size: 24px; border: none; touch-action: manipulation;
        }
        .control-btn:active { background: #666; }

        /* ê²°ê³¼ì°½ (ìº¡ì²˜ìš©) */
        .capture-card {
            background: #fff; color: #000; padding: 20px; border-radius: 15px; margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); text-align: center;
        }
        .capture-title { color: #555; font-size: 14px; margin-bottom: 5px; }
        .capture-score { font-size: 40px; font-weight: 900; color: #6200ea; margin: 10px 0; }
        .capture-rank { font-size: 16px; font-weight: bold; color: #ff5252; }

    </style>
</head>
<body>

<div class="container">

    <div id="scene-intro" class="scene active">
        <h1 style="font-size: 40px; margin-bottom: 30px;">ğŸ® GAME ZONE</h1>
        <button class="btn btn-main" onclick="goLobby()">ğŸ‘¥ ë‹¤ê°™ì´ í•˜ê¸°<br><span style="font-size:14px">(ë°©ì¥ ì§„í–‰ / ë‹¨ì²´ê²Œì„)</span></button>
        <button class="btn btn-personal" onclick="goPersonalMenu()">ğŸ‘¤ í˜¼ì í•˜ê¸°<br><span style="font-size:14px">(ê°œì¸ ê¸°ë¡ / ìº¡ì²˜ ê³µìœ )</span></button>
    </div>

    <div id="scene-lobby" class="scene">
        <h2>ğŸ‘¥ ë‹¨ì²´ ê²Œì„ ë¡œë¹„</h2>
        <div class="sub-title">HOST í™”ë©´ ê³µìœ  í•„ìˆ˜</div>
        
        <div class="roster-box">
            <div style="color:#aaa; font-size:12px;">ì°¸ê°€ì ëª…ë‹¨ (<span id="count">0</span>ëª…)</div>
            <textarea id="name-input" placeholder="ì´ë¦„ ì…ë ¥ (ì½¤ë§ˆë¡œ êµ¬ë¶„)"></textarea>
            <button class="btn" style="background:#03dac6; margin-top:5px;" onclick="updateRoster()">ëª…ë‹¨ ë“±ë¡</button>
            <div id="player-list-display"></div>
        </div>

        <div class="btn-grid">
            <button class="btn c-race" onclick="goGroupGame('race')">ğŸƒ ë‹¬ë¦¬ê¸°</button>
            <button class="btn c-bomb" onclick="goGroupGame('bomb')">ğŸ’£ í­íƒ„ì œê±°</button>
            <button class="btn c-tree" onclick="goGroupGame('tree')">ğŸŒ³ ë²„í‹°ê¸°</button>
            <button class="btn c-bridge" onclick="goGroupGame('bridge')">ğŸŒ‰ ìœ ë¦¬ë‹¤ë¦¬</button>
            <button class="btn c-pong" onclick="goGroupGame('pong')">ğŸ“ í•‘í</button>
            <button class="btn c-draw" onclick="goGroupGame('draw')">ğŸ² ë½‘ê¸°</button>
        </div>
        <button class="btn btn-home" onclick="goHome()">â¬… ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <div id="scene-group-game" class="scene">
        <h3 id="g-title">ê²Œì„ ì œëª©</h3>
        <div id="g-content"></div> <button class="btn" id="g-start-btn" style="background:#fff; margin-top:10px;" onclick="runGroupGame()">ì‹œì‘í•˜ê¸°</button>
        <div id="g-result" class="capture-card" style="display:none; background:#222; color:#fff;"></div>
        <button class="btn btn-home" onclick="goLobby()">ëª©ë¡ìœ¼ë¡œ</button>
    </div>


    <div id="scene-personal-menu" class="scene">
        <h2>ğŸ‘¤ ê°œì¸ ê¸°ë¡ ë„ì „</h2>
        <p style="color:#aaa; font-size:13px;">ìµœê³  ì ìˆ˜ë¥¼ ìº¡ì²˜í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</p>
        
        <button class="btn" style="background:#ff5252; color:#fff; padding: 25px 0;" onclick="startShootingGame()">
            ğŸ”« ìŠ¤ë‚˜ì´í¼ ì‚¬ê²©<br><span style="font-size:12px; font-weight:normal;">30ì´ˆ ë™ì•ˆ íƒ€ê²Ÿ ë§ì¶”ê¸°</span>
        </button>
        
        <button class="btn" style="background:#448aff; color:#fff; padding: 25px 0;" onclick="startDodgeGame()">
            â˜„ï¸ ë˜¥ í”¼í•˜ê¸° (í‚¤ë³´ë“œ/í„°ì¹˜)<br><span style="font-size:12px; font-weight:normal;">í•˜ëŠ˜ì—ì„œ ë–¨ì–´ì§€ëŠ” ì¥ì• ë¬¼ í”¼í•˜ê¸°</span>
        </button>

        <button class="btn btn-home" onclick="goHome()">â¬… ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <div id="scene-shooting" class="scene">
        <h3>ğŸ”« ìŠ¤ë‚˜ì´í¼ ì‚¬ê²©</h3>
        <p style="font-size:12px; color:#aaa;">ë‚˜íƒ€ë‚˜ëŠ” íƒ€ê²Ÿì„ ë¹ ë¥´ê²Œ í´ë¦­í•˜ì„¸ìš”!</p>
        <div class="game-canvas-box">
            <canvas id="canvas-shoot"></canvas>
            <div class="score-board">SCORE: <span id="s-score">0</span></div>
            <div class="time-board">TIME: <span id="s-time">30</span></div>
        </div>
        <div id="res-shooting" class="capture-card" style="display:none">
            <div class="capture-title">ğŸ”« ìŠ¤ë‚˜ì´í¼ ì‚¬ê²© ê²°ê³¼</div>
            <div class="capture-score" id="final-s-score">0ì </div>
            <div class="capture-rank" id="s-rank-msg"></div>
            <div style="font-size:11px; color:#888; margin-top:5px;">ì´ í™”ë©´ì„ ìº¡ì²˜í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</div>
        </div>
        <button class="btn btn-retry" onclick="startShootingGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="btn btn-home" onclick="goPersonalMenu()">ë©”ë‰´ë¡œ ë‚˜ê°€ê¸°</button>
    </div>

    <div id="scene-dodge" class="scene">
        <h3>â˜„ï¸ ì¥ì• ë¬¼ í”¼í•˜ê¸°</h3>
        <p style="font-size:12px; color:#aaa;">PC: ë°©í–¥í‚¤(â† â†’) / ëª¨ë°”ì¼: í•˜ë‹¨ ë²„íŠ¼</p>
        <div class="game-canvas-box">
            <canvas id="canvas-dodge"></canvas>
            <div class="score-board">SCORE: <span id="d-score">0</span></div>
        </div>
        
        <div class="mobile-controls">
            <button class="control-btn" ontouchstart="moveDodge('left')" onmousedown="moveDodge('left')" ontouchend="stopDodge()" onmouseup="stopDodge()">â¬…</button>
            <button class="control-btn" ontouchstart="moveDodge('right')" onmousedown="moveDodge('right')" ontouchend="stopDodge()" onmouseup="stopDodge()">â¡</button>
        </div>

        <div id="res-dodge" class="capture-card" style="display:none">
            <div class="capture-title">â˜„ï¸ ìƒì¡´ ê¸°ë¡</div>
            <div class="capture-score" id="final-d-score">0ì </div>
            <div class="capture-rank">ë‹¹ì‹ ì˜ ìˆœë°œë ¥ì€?</div>
            <div style="font-size:11px; color:#888; margin-top:5px;">ì´ í™”ë©´ì„ ìº¡ì²˜í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</div>
        </div>
        <button class="btn btn-retry" onclick="startDodgeGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="btn btn-home" onclick="goPersonalMenu()">ë©”ë‰´ë¡œ ë‚˜ê°€ê¸°</button>
    </div>

</div>

<script>
    /* ================= ê³µí†µ ë¡œì§ ================= */
    function goHome() { showScene('scene-intro'); stopAllGames(); }
    function goLobby() { showScene('scene-lobby'); stopAllGames(); }
    function goPersonalMenu() { showScene('scene-personal-menu'); stopAllGames(); }
    
    function showScene(id) {
        document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    
    function stopAllGames() {
        // ê·¸ë£¹ ê²Œì„ íƒ€ì´ë¨¸ ì •ë¦¬
        if(window.groupTimer) clearInterval(window.groupTimer);
        // ê°œì¸ ê²Œì„ ë£¨í”„ ì •ë¦¬
        if(window.shootTimer) clearInterval(window.shootTimer);
        if(window.gameLoop) cancelAnimationFrame(window.gameLoop);
        window.isGameRunning = false;
    }

    /* ================= ê·¸ë£¹ ëª¨ë“œ ë¡œì§ (ìš”ì•½) ================= */
    let players = [];
    let curGroupGame = '';
    const animals = ['ğŸ¶','ğŸ±','ğŸ¹','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¸','ğŸ°'];

    function updateRoster() {
        const val = document.getElementById('name-input').value;
        players = val.split(/[,|\n]+/).map(n=>n.trim()).filter(n=>n);
        const div = document.getElementById('player-list-display');
        div.innerHTML = '';
        players.forEach(p => div.innerHTML += `<span class="player-tag">${p}</span>`);
        document.getElementById('count').innerText = players.length;
        if(players.length>0) alert("ë“±ë¡ ì™„ë£Œ!");
    }

    function goGroupGame(type) {
        if(players.length < 2) return alert("ì°¸ê°€ì ëª…ë‹¨ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!");
        curGroupGame = type;
        showScene('scene-group-game');
        document.getElementById('g-result').style.display='none';
        const content = document.getElementById('g-content');
        const title = document.getElementById('g-title');
        const btn = document.getElementById('g-start-btn');
        btn.style.display = 'block';
        content.innerHTML = '';

        if(type==='race') { title.innerText='ğŸƒ ë‹¬ë¦¬ê¸°'; content.innerHTML='<div id="track" style="background:#333; padding:10px;"></div>'; initRaceUI(); }
        else if(type==='bomb') { title.innerText='ğŸ’£ í­íƒ„ í•´ì²´'; content.innerHTML='<div style="font-size:50px;">ğŸ’£</div><div id="wires" style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-top:20px;"></div>'; initBombUI(); }
        else if(type==='tree') { title.innerText='ğŸŒ³ ë²„í‹°ê¸°'; content.innerHTML='<div style="height:200px; background:#2e7d32; position:relative; border-radius:10px;" id="tree-bg"></div>'; initTreeUI(); }
        else if(type==='bridge') { title.innerText='ğŸŒ‰ ìœ ë¦¬ë‹¤ë¦¬'; content.innerHTML='<div id="bridge-box" style="height:300px; background:#000; overflow-y:auto; padding:10px;"></div>'; document.getElementById('bridge-box').innerHTML='<div style="color:#aaa">ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìƒì„±ë©ë‹ˆë‹¤</div>'; btn.onclick=startBridge; }
        else if(type==='pong') { title.innerText='ğŸ“ í•‘í'; content.innerHTML='<canvas id="pong-c" width="300" height="300" style="background:#000; border:1px solid #ffeb3b;"></canvas>'; btn.onclick=startPong; }
        else if(type==='draw') { title.innerText='ğŸ² ì œë¹„ë½‘ê¸°'; content.innerHTML='<div id="draw-box" style="display:flex; flex-wrap:wrap; justify-content:center; gap:5px;"></div>'; initDrawUI(); }
    }

    function runGroupGame() {
        if(curGroupGame==='race') startRace();
        if(curGroupGame==='bomb') alert("ê°€ìœ„ë°”ìœ„ë³´ ì§„ ì‚¬ëŒë¶€í„° ì„ ì„ í•˜ë‚˜ì”© ëˆ„ë¥´ì„¸ìš”!");
        if(curGroupGame==='tree') startTree();
        if(curGroupGame==='draw') startDraw();
        // bridge, pongì€ ê°œë³„ start í•¨ìˆ˜ ìˆìŒ
    }

    // -- ê·¸ë£¹ ê²Œì„ UI ì´ˆê¸°í™” ë° ì‹¤í–‰ í•¨ìˆ˜ë“¤ (ê³µê°„ ì ˆì•½ì„ ìœ„í•´ í•µì‹¬ë§Œ) --
    function initRaceUI(){const t=document.querySelector('#track');t.innerHTML='<div style="position:absolute; right:10px; height:100%; width:2px; background:red;"></div>';players.forEach((p,i)=>t.innerHTML+=`<div class="lane"><span id="r-${i}" class="animal">${animals[i%8]}</span><small style="margin-left:30px">${p}</small></div>`)}
    function startRace(){document.getElementById('g-start-btn').style.display='none';let racers=players.map((p,i)=>({id:i,n:p,x:0}));window.groupTimer=setInterval(()=>{let done=true;racers.forEach(r=>{if(r.x<90){done=false;r.x+=Math.random()*2;document.getElementById(`r-${r.id}`).style.left=r.x+'%'}});if(done){clearInterval(window.groupTimer);showGroupResult(racers.sort((a,b)=>b.x-a.x).map(r=>r.n));}},50)}
    function initBombUI(){const w=document.getElementById('wires');let bomb=Math.floor(Math.random()*players.length);players.forEach((p,i)=>{w.innerHTML+=`<button onclick="if(${i}===${bomb}){alert('ì¾…!');showGroupResult(['${p} (íƒˆë½)']);}else{this.style.opacity=0.3;this.innerText='í†µê³¼'}" style="padding:10px; flex:1 0 40%;">${p}</button>`})}
    function initTreeUI(){const t=document.getElementById('tree-bg');players.forEach((p,i)=>{t.innerHTML+=`<div id="f-${i}" style="position:absolute; top:${Math.random()*100}px; left:${Math.random()*250}px; background:orange; width:30px; height:30px; border-radius:50%; line-height:30px; font-size:10px;">${p}</div>`})}
    function startTree(){let fallen=0,res=[];let times=players.map(p=>({n:p,t:Math.random()*4000+1000})).sort((a,b)=>a.t-b.t);times.forEach(x=>{setTimeout(()=>{const el=[...document.querySelectorAll('div[id^="f-"]')].find(e=>e.innerText==x.n);if(el){el.style.top='170px';el.style.background='#555';fallen++;res.push(x.n);if(fallen==players.length)showGroupResult(res.reverse())}},x.t)})}
    function initDrawUI(){const d=document.getElementById('draw-box');players.forEach(p=>d.innerHTML+='<div class="card" style="width:60px;height:80px;background:#ba68c8;margin:5px;display:flex;align-items:center;justify-content:center;">?</div>')}
    function startDraw(){const d=document.getElementById('draw-box');d.innerHTML='';[...players].sort(()=>Math.random()-0.5).forEach((p,i)=>{setTimeout(()=>{d.innerHTML+=`<div style="width:60px;height:80px;background:#fff;color:#000;margin:5px;border:1px solid #ba68c8;display:flex;align-items:center;justify-content:center;font-size:12px;">${i+1}ë“±<br>${p}</div>`},i*500)})}
    
    // Bridge & Pong (ê°„ëµ)
    function startBridge(){alert("í™”ë©´ ê³µìœ  ì¤‘ì¸ MCê°€ ì§„í–‰í•´ì£¼ì„¸ìš”!");} 
    function startPong(){alert("í™”ë©´ ê³µìœ  ì¤‘ì¸ MCê°€ ì§„í–‰í•´ì£¼ì„¸ìš”!");}

    function showGroupResult(list){
        const r=document.getElementById('g-result'); r.style.display='block';
        r.innerHTML=`<h3>ğŸ† ê²°ê³¼</h3><div style="font-size:20px; color:gold;">1ìœ„: ${list[0]}</div>`+(list[1]?`<div>2ìœ„: ${list[1]}</div>`:'');
    }


    /* ================= ğŸ‘¤ ê°œì¸ ëª¨ë“œ: ìŠ¤ë‚˜ì´í¼ ì‚¬ê²© ================= */
    let sScore = 0;
    let sTime = 30;
    let targets = [];
    
    function startShootingGame() {
        showScene('scene-shooting');
        document.getElementById('res-shooting').style.display = 'none';
        sScore = 0; sTime = 30; targets = [];
        document.getElementById('s-score').innerText = 0;
        document.getElementById('s-time').innerText = 30;
        
        const canvas = document.getElementById('canvas-shoot');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        const ctx = canvas.getContext('2d');
        
        // í´ë¦­ ì´ë²¤íŠ¸
        canvas.onmousedown = canvas.ontouchstart = function(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            // í„°ì¹˜/í´ë¦­ ì¢Œí‘œ í†µì¼
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const x = clientX - rect.left;
            const y = clientY - rect.top;
            
            // íƒ€ê²Ÿ ì ì¤‘ ì²´í¬ (ë’¤ì—ì„œë¶€í„° ì²´í¬í•´ì•¼ ìœ„ì— ìˆëŠ”ê²Œ ë§ìŒ)
            for (let i = targets.length - 1; i >= 0; i--) {
                const t = targets[i];
                const dist = Math.sqrt((x - t.x)**2 + (y - t.y)**2);
                if (dist < t.r) {
                    // ëª…ì¤‘!
                    sScore += 10 + Math.floor((30 - t.r)); // ì‘ì€ê±° ë§ì¶”ë©´ ì ìˆ˜ ë”ì¤Œ
                    document.getElementById('s-score').innerText = sScore;
                    targets.splice(i, 1); // ì œê±°
                    createTarget(canvas.width, canvas.height); // ë°”ë¡œ ìƒˆê±° ìƒì„±
                    return; // í•˜ë‚˜ë§Œ ë§ìŒ
                }
            }
        };

        window.isGameRunning = true;
        
        // íƒ€ì´ë¨¸
        window.shootTimer = setInterval(() => {
            sTime--;
            document.getElementById('s-time').innerText = sTime;
            if(sTime <= 0) endShootingGame();
        }, 1000);

        // ê²Œì„ ë£¨í”„ (ê·¸ë¦¬ê¸°)
        function loop() {
            if(!window.isGameRunning) return;
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // íƒ€ê²Ÿ ê´€ë¦¬
            if(targets.length < 3) createTarget(canvas.width, canvas.height);

            targets.forEach(t => {
                t.life--; 
                // ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.arc(t.x, t.y, t.r, 0, Math.PI*2);
                ctx.fillStyle = t.color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ì‹­ìì„  ë¬´ëŠ¬
                ctx.beginPath();
                ctx.moveTo(t.x - t.r/2, t.y); ctx.lineTo(t.x + t.r/2, t.y);
                ctx.moveTo(t.x, t.y - t.r/2); ctx.lineTo(t.x, t.y + t.r/2);
                ctx.stroke();
            });

            // ìˆ˜ëª… ë‹¤í•œ íƒ€ê²Ÿ ì œê±° ë° ë¦¬í•„
            targets = targets.filter(t => t.life > 0);

            window.gameLoop = requestAnimationFrame(loop);
        }
        loop();
    }

    function createTarget(w, h) {
        targets.push({
            x: Math.random() * (w - 60) + 30,
            y: Math.random() * (h - 60) + 30,
            r: Math.random() * 20 + 15, // ë°˜ì§€ë¦„ 15~35
            life: 100 + Math.random() * 50, // í”„ë ˆì„ ìˆ˜ëª…
            color: `hsl(${Math.random()*360}, 70%, 50%)`
        });
    }

    function endShootingGame() {
        stopAllGames();
        document.getElementById('res-shooting').style.display = 'block';
        document.getElementById('final-s-score').innerText = sScore + "ì ";
        
        let msg = "ğŸ”« ì‚¬ê²© í›ˆë ¨ë³‘";
        if(sScore > 500) msg = "ğŸ”« ë² í…Œë‘ ìŠ¤ë‚˜ì´í¼";
        if(sScore > 1000) msg = "ğŸ”« ì „ì„¤ì˜ ëª…ì‚¬ìˆ˜";
        document.getElementById('s-rank-msg').innerText = msg;
    }


    /* ================= ğŸ‘¤ ê°œì¸ ëª¨ë“œ: í”¼í•˜ê¸° ê²Œì„ ================= */
    let dScore = 0;
    let playerX = 0;
    let meteors = [];
    let moveDir = 0; // -1: left, 1: right
    
    function startDodgeGame() {
        showScene('scene-dodge');
        document.getElementById('res-dodge').style.display = 'none';
        dScore = 0;
        document.getElementById('d-score').innerText = 0;
        
        const canvas = document.getElementById('canvas-dodge');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        const ctx = canvas.getContext('2d');
        
        playerX = canvas.width / 2;
        meteors = [];
        window.isGameRunning = true;
        let frame = 0;

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        window.onkeydown = (e) => {
            if(e.code === 'ArrowLeft') moveDir = -1;
            if(e.code === 'ArrowRight') moveDir = 1;
        };
        window.onkeyup = (e) => {
            if(e.code === 'ArrowLeft' || e.code === 'ArrowRight') moveDir = 0;
        };

        function loop() {
            if(!window.isGameRunning) return;
            frame++;
            dScore++; // ìƒì¡´ ì ìˆ˜
            document.getElementById('d-score').innerText = dScore;

            // ë°°ê²½
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // í”Œë ˆì´ì–´ ì´ë™
            playerX += moveDir * 5;
            if(playerX < 15) playerX = 15;
            if(playerX > canvas.width - 15) playerX = canvas.width - 15;

            // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸° (ì‚¼ê°í˜•)
            ctx.fillStyle = '#00e676';
            ctx.beginPath();
            ctx.moveTo(playerX, canvas.height - 40);
            ctx.lineTo(playerX - 15, canvas.height - 10);
            ctx.lineTo(playerX + 15, canvas.height - 10);
            ctx.fill();

            // ì¥ì• ë¬¼ ìƒì„± (ì ì  ì–´ë µê²Œ)
            let frequency = 30; // 30í”„ë ˆì„ë§ˆë‹¤ ìƒì„± (ì´ˆê¸°)
            if(dScore > 1000) frequency = 20;
            if(dScore > 2000) frequency = 10;
            
            if(frame % frequency === 0) {
                meteors.push({
                    x: Math.random() * canvas.width,
                    y: -20,
                    size: Math.random() * 10 + 10,
                    speed: Math.random() * 3 + 2 + (dScore/2000) // ì ì  ë¹¨ë¼ì§
                });
            }

            // ì¥ì• ë¬¼ ì´ë™ ë° ì¶©ëŒ
            for(let i=0; i<meteors.length; i++) {
                let m = meteors[i];
                m.y += m.speed;

                // ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#ff5252';
                ctx.beginPath();
                ctx.arc(m.x, m.y, m.size, 0, Math.PI*2);
                ctx.fill();

                // ì¶©ëŒ ì²´í¬ (ê°„ë‹¨í•œ ì›-ì  ê±°ë¦¬ ì²´í¬)
                // í”Œë ˆì´ì–´ ì¤‘ì‹¬ë¶€ì™€ ê±°ë¦¬
                if(Math.abs(m.x - playerX) < (m.size + 10) && 
                   Math.abs(m.y - (canvas.height-20)) < (m.size + 10)) {
                    endDodgeGame();
                    return;
                }
            }
            
            // í™”ë©´ ë°– ë‚˜ê°„ ì¥ì• ë¬¼ ì œê±°
            meteors = meteors.filter(m => m.y < canvas.height + 50);

            window.gameLoop = requestAnimationFrame(loop);
        }
        loop();
    }
    
    // ëª¨ë°”ì¼ í„°ì¹˜ ì»¨íŠ¸ë¡¤
    function moveDodge(dir) {
        if(dir === 'left') moveDir = -1;
        if(dir === 'right') moveDir = 1;
    }
    function stopDodge() { moveDir = 0; }

    function endDodgeGame() {
        stopAllGames();
        document.getElementById('res-dodge').style.display = 'block';
        document.getElementById('final-d-score').innerText = dScore + "ì ";
    }

</script>
</body>
</html>
